<div class="content">
    <div class="pull-right">


        <button type="button" class="btn btn-primary btn-sm" ng-click="buscarProposicoes()" class="btn btn-success"><i class="fa fa-plus"></i> Buscar/Adicionar proposições</a>

    </div>
    <h3>Consultar Proposições</h3>
    <div class="row">
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="clearfix">
                    <div class="row" role="form">

                        <div class="col-sm-2">
                            <label>Pela sigla:</label>
                            <input type="text" class="form-control" ng-model="filtro.sigla" placeholder="Filtrar pela sigla" ng-change="filtrarConsulta()">
                        </div>
                        <div class="col-sm-3">
                            <label>Pela ementa:</label>
                            <input type="text" class="form-control" ng-model="filtro.ementa" placeholder="Filtrar pela ementa" ng-change="filtrarConsulta()">
                        </div>
                        <div class="col-sm-3">
                            <label>Por autor:</label>
                            <input type="text" class="form-control" ng-model="filtro.autor" placeholder="Filtrar por autor" ng-change="filtrarConsulta()">
                        </div>
                        <div class="col-sm-2">
                            <label>Por casa legislativa:</label>
                            <select ng-model="filtro.origem" class="form-control" ng-change="filtrarConsulta()">
                                <option value=""></option>
                                <option value="CAMARA">CAMARA</option>
                                <option value="SENADO">SENADO</option>
                            </select>
                        </div>
                        <div class="col-sm-2">
                            <label>Por favoritas:</label>
                            <select ng-model="filtro.isFavorita" class="form-control" ng-change='filtrarConsulta()'>
                                <option value=""></option>
                                <option value="true">Favoritas</option>
                                <option value="false">Não-favoritas</option>
                            </select>
                        </div>

                    </div>
                    <div class="row" role="form">
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div infinite-scroll='consultarProposicoes()' infinite-scroll-disabled='infiniteScroll.busy'>
                    <div ng-repeat="item in listaReuniaoProposicoes | orderBy : 'seqOrdemPauta'" class="list-group-item clearfix" ng-click="setSelectedProposicao(item)">
                        <div class="row">
                            <div class="col-sm-7">

                                <h3 class="list-group-item-heading">
									<i class="fa fa-star-o" ng-show="!item.favorita"
										ng-click="item.favorita=true;save(item)"></i> <i
										class="fa fa-star" style="color: orange"
										ng-show="item.favorita"
										ng-click="item.favorita=false;save(item)"></i> <a href="#/Proposicao/id/{{item.id}}" target="_blank">{{item.sigla}}</a> 
                                        
                                        <div class="pull-right label">                                            
                                            <span class="label bg-gray" ng-if="item.estado=='FORADEPAUTA'" style="color:white" title="Proposição não é de interesse da SAL">Fora de pauta</span>
                                            <span class="label label-warning" ng-if="item.estado=='EMANALISE'" title="Proposição está sendo analisada pela equipe da SAL">Em análise</span>
                                            <span class="label label-info" ng-if="item.estado=='ANALISADA'" title="Análise aguarda aprovação do diretor da equipe da SAL">Em revisão</span>
                                            <span class="label label-primary" ng-if="item.estado=='ADESPACHAR'"  title="Análise aguarda despacho do secretário">Aguardando despacho</span>                                            
                                            <span class="label label-success" ng-if="item.estado=='DESPACHADA'" title="Proposição com posicionamento despachado pelo secretário">Despachada</span>
                                        </div>
								</h3>
                                <strong>  Tema/O que faz: </strong>
                                <pre style="border:none;border-radius:0px;border-top: 1px solid #ddd; border-bottom: 1px solid #eee;    padding: 15px;background-color:white;font-family:inherit;"
                                ng-click="showTextArea=true;temaTxt=true;" ng-hide="showTextArea || item.explicacao==null"
                                style="margin-bottom=0">{{item.explicacao}}</pre>
                                <textarea class="form-control fontsize-sm " rows="3" ng-show="showTextArea || item.explicacao==null" placeholder="Sem tema SAL. Digite o tema da proposição..."
                                ngTrim="true" ng-model="item.explicacao" ng-change="setUpdated('explicacao',item)" ng-blur="checkUpdatedField('explicacao',item);showTextArea=false"
                                focus-me="temaTxt" style="margin-bottom:5px;"></textarea>

                                <a style="font-size:14px;font-weight:bold;" data-toggle="collapse" data-target="#ementaProposicao{{item.idProposicao}}" aria-expanded="false"
                                aria-controls="ementaProposicao{{item.idProposicao}}">
                                    Ver ementa  
                                </a>
                                <div class="collapse" id="ementaProposicao{{item.idProposicao}}">
                                    {{item.ementa}}
                                </div>
                                <br/>


                                <strong>Autor: </strong>{{item.autor}}
                                <br /> <strong>Origem: </strong>{{item.origem}}
                                <br />
                                <strong>Comissao: </strong>{{item.pautaComissaoAtual.pautaReuniaoComissao.comissao}}
                                <br/>
                                <strong>Ordem na Pauta: </strong>{{item.pautaComissaoAtual.ordemPauta}} <span ng-show="item.pautaComissaoAtual.pautaReuniaoComissao.manual!=true">({{item.pautaComissaoAtual.pautaReuniaoComissao.data | date:'dd/MM HH:mm'}})</span>
                                <br/>
                                <strong>Relator: </strong><span ng-if="item.pautaComissaoAtual.relator==null">Não identificado</span>{{item.pautaComissaoAtual.relator}}
                                <br/>
                                <span ng-show="item.origem == 'SENADO'">
									<a
										href="http://www.senado.leg.br/atividade/materia/detalhes.asp?p_cod_mate={{item.idProposicao}}#DIV_TRAMITACAO"
										target="_blank"><i class="fa fa-history"></i> Histórico de Tramitação</a>
								</span>
                                <span ng-show="item.origem == 'CAMARA'">
									<a
										href="http://www.camara.gov.br/proposicoesWeb/fichadetramitacao?idProposicao={{item.idProposicao}}#tramitacoes"
										target="_blank"><i class="fa fa-history"></i> Histórico de Tramitação</a>
								</span>
                                <span class="divider-left">
                                    <a  ng-show="isFollowed(item)" href ng-click="unfollowProposicao(item);"><i class="fa fa-check-square-o"></i> Seguindo proposição</a>
                                    <a  ng-show="!isFollowed(item)" href ng-click="followProposicao(item);"><i class="fa fa-square-o"></i> Seguir proposição</a>
								</span>
                                <span class="divider-left">
                                    <a  href ng-click="checkUpdates(item);"><i class="fa  fa-refresh"></i> Atualizar dados da {{item.origem}}</a>

								</span>

                                <div class="divider-top clearfix">

                                    <div>
                                        <label>Posicionamento SAL: </label> <span ng-click="editPosicaoSAL=true;posicaoSALInput=true;"
                                        ng-hide="editPosicaoSAL"><span ng-if="item.posicionamentoAtual==null">Sem posicionamento</span>{{item.posicionamentoAtual.posicionamento.nome}}</span>
                                        <div ng-show="editPosicaoSAL">
                                            <input focus-me="posicaoSALInput" type="text" ng-model="item.posicionamentoAtual.posicionamento" placeholder="Procurar" ng-required="true"
                                            ng-focus="previousPosicionamento(item);" ng-blur="checkRemocaoPosicionamento(item);"
                                            typeahead="posicao as posicao.nome for posicao in getPosicionamentos($viewValue) | filter:$viewValue"
                                            typeahead-on-select="alterarPosicionamento(item, $model, $label); item.posicionamentoNaoDefinido = false;editPosicaoSAL=false;"
                                            class="form-control">
                                        </div>
                                    </div>
                                    <div>
                                        <strong>Parecer SAL: </strong>
                                        <pre style="border:none;border-radius:0px;border-top: 1px solid #ddd; border-bottom: 1px solid #eee;    padding: 15px;background-color:white;font-family:inherit;"
                                        ng-click="showParecerTextArea=true;parecerTXT=true;" ng-hide="showParecerTextArea"
                                        style="margin-bottom=0"><span ng-if="item.parecerSAL==null">Sem parecer</span>{{item.parecerSAL}}</pre>
                                        <textarea class="form-control fontsize-sm " rows="3" ng-show="showParecerTextArea " placeholder="Descreva o parecer da SAL..."
                                        ngTrim="true" ng-model="item.parecerSAL" ng-change="setUpdated('parecerSAL',item)"
                                        ng-blur="checkUpdatedField('parecerSAL',item);showParecerTextArea=false" focus-me="parecerTXT"
                                        style="margin-bottom:5px;"></textarea>
                                    </div>


                                    <div>
                                        <label>Responsável: </label> <span ng-click="editResponsavel=true;responsavelInput=true;"
                                        ng-hide="editResponsavel"><span ng-if="item.responsavel==null">Sem responsável</span>{{item.responsavel.nome}}</span>
                                        <div ng-show="editResponsavel">
                                            <input focus-me="responsavelInput" type="text" ng-model="item.responsavel" placeholder="Procurar usuário" ng-required="true"
                                            typeahead="item as item.nome for item in getUsuarios($viewValue, buscaGeral)"
                                            typeahead-on-select="save(item); item.responsavelNaoDefinido = false;editResponsavel=false;"
                                            class="form-control">
                                            <input type="checkbox" ng-model="item.buscaGeral"> Buscar completa
                                        </div>
                                    </div>
                                    <div class="row">
                                        
                                        <div class="col-md-6">
                                            <strong> <a ng-click="abrirModalNotaTecnica(item)"><i
														class="fa fa-comment"></i> {{item.totalNotasTecnicas}} notas técnicas</a></strong>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <strong>Área Específica: </strong> Nenhuma área associada
                                        </div>
                                        <div class="col-lg-6">
                                            <strong>Posicionamento Área Específica: </strong> Sem posicionamento
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <div class="col-sm-5">
                                <div class="panel panel-default">
                                    <div class="panel-heading cursor-pointer" ng-click="showAcoes = !showAcoes;populaProposicao(item);">
                                        Ações <i class="fa fa-sort"></i>
                                    </div>
                                    <div class="panel-body" collapse="showAcoes">
                                        <div class="row text-center divider-bottom">
                                            <button ng-if="Auth.isAspar(true) && item.estado=='FORADEPAUTA'" type="button" class="btn btn-success btn-sm" title="Marcar análise SAL"
                                            ng-click="setaEstado(item,'EMANALISE')">

                                                <i class="fa fa-mail-forward"></i> Marcar para análise da SAL</button>
                                            <button ng-if="Auth.isEquipe(true) && item.estado=='EMANALISE'" type="button" class="btn btn-success btn-sm" title="Análise Completa"
                                            ng-click="setaEstado(item,'ANALISADA')">
                                                <i class="fa fa-check-circle-o"></i> Análise completa</button>
                                            <button ng-if="Auth.isDiretor(true) && item.estado=='ANALISADA'" type="button" class="btn btn-success btn-sm" title="Análise Completa"
                                            ng-click="setaEstado(item,'ADESPACHAR')">
                                                <i class="fa fa-check-circle"></i> Enviar para despacho</button>
                                            <button ng-if="Auth.isSecretario(true) && item.estado=='ADESPACHAR'" type="button" class="btn btn-success btn-sm" title="Análise Completa"
                                            ng-click="setaEstado(item,'DESPACHADA')">
                                                <i class="fa fa-paper-plane"></i> Despachar</button>

                                            <button ng-if="Auth.isDiretor(true) && (item.estado=='ANALISADA' || item.estado=='ADESPACHAR')" type="button" class="btn btn-warning btn-sm"
                                            title="Análise Completa" ng-click="setaEstado(item,'EMANALISE')">
                                                <i class="fa fa-retweet"></i> Re-Analisar</button>
                                        </div>
                                        <div class=" clearfix">

                                            <div class="col-md-12">
                                                <div ng-show="item.listaComentario.length > 0">
                                                    <strong>Últimos comentários:</strong>

                                                    <p>{{item.listaComentario[item.listaComentario.length-1].dataCriacao | date:
                                                        'dd/MM/yyyy'}} - {{item.listaComentario[item.listaComentario.length-1].descricao}}
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="col-md-10">
                                                <textarea class="form-control fontsize-sm" rows="1" placeholder="Adicione um comentário" ng-model="item.comentarioTmp"></textarea>
                                            </div>
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-success btn-sm" ng-click="incluirComentario(item)">
                                                    <i class="fa fa-check"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="divider-top clearfix">
                                            <div class="col-md-6">
                                                <strong> <a ng-click="abrirModalComentarios(item)"><i
														class="fa fa-comment"></i> {{item.totalComentarios}} comentários</a></strong>
                                            </div>
                                            <div class="col-md-6 text-right">
                                                <strong><a
													ng-click="abrirModalEncaminhamentos(item)">
														{{item.listaEncaminhamentoProposicao.length || item.totalEncaminhamentos}}
														encaminhamentos</a></strong>
                                            </div>
                                        </div>
                                        <div class="divider-top form-inline" ng-if="Auth.isEquipe()">
                                            <div class="form-group">
                                                <label>Posicionamento:</label>
                                                <input type="text" ng-model="item.posicionamentoAtual.posicionamento" placeholder="Procurar" ng-required="true" ng-focus="previousPosicionamento(item)"
                                                ng-blur="checkRemocaoPosicionamento(item)" typeahead="posicao as posicao.nome for posicao in getPosicionamentos($viewValue) | filter:$viewValue"
                                                typeahead-on-select="alterarPosicionamento(item, $model, $label); item.posicionamentoNaoDefinido = false"
                                                class="form-control">
                                            </div>
                                        </div>
                                        <div class="divider-top form-inline" ng-if="Auth.isEquipe()">
                                            <div class="form-group">
                                                <label>Responsável: </label>
                                                <input type="text" ng-model="item.responsavel" placeholder="Procurar usuário" ng-required="true" typeahead="item as item.nome for item in getUsuarios($viewValue, buscaGeral)"
                                                typeahead-on-select="save(item); item.responsavelNaoDefinido = false" class="form-control">
                                                <input type="checkbox" ng-model="item.buscaGeral"> Buscar completa
                                            </div>
                                        </div>
                                        <div class="divider-top row">
                                            <label>Situação: </label>
                                            <div class="form-group">
                                                <div class="col-md-10">
                                                    <textarea class="form-control fontsize-sm" rows="3" placeholder="Adicione um resultado" ng-model="item.resultadoASPAR"></textarea>
                                                </div>
                                                <div class="col-md-2">
                                                    <button type="button" class="btn btn-success btn-sm" ng-click="save(item)"><i class="fa fa-check"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="divider-top row">
                                            <label>Macrotema: </label>
                                            <div class="form-group">
                                                <tags-input ng-model="item.tags" ng-class="form-group" on-tag-added="save(item)" on-tag-removed="save(item)" min-length="1"
                                                placeholder="Adicione uma palavra chave" display-property="tag">
                                                    <auto-complete source="loadTags($query)"></auto-complete>
                                                </tags-input>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>